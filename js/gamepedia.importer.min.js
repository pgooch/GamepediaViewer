postMessage({message:"Downloading database..."});var request=new XMLHttpRequest;request.addEventListener("error",function(){postMessage({message:"There was an error loading the database"})}),request.addEventListener("abort",function(){postMessage({message:"Database load has been canceled."})}),request.addEventListener("load",function(e){postMessage({message:"Getting Games from Database..."});try{var s=JSON.parse(e.srcElement.response).entries;postMessage({message:"Preparing Local Database.."});var a=indexedDB.open("gamepedia",14);a.addEventListener("upgradeneeded",function(e){var s=e.target.result;if(postMessage({message:"Creating/Updating Tables..."}),0==s.objectStoreNames.contains("games")){var s=s.createObjectStore("games");s.createIndex("title","ZTITLE",{unique:!1})}}),a.onsuccess=function(e){var a=e.target.result;postMessage({message:"Clearing Old Data..."});var t={},r=a.transaction(["games"],"readwrite"),n=r.objectStore("games"),o=n.openCursor();o.onsuccess=function(e){var r=e.target.result;if(null!=r)r.delete(),r.continue();else{postMessage({message:"Preparing to add entries..."});var n=a.transaction(["games"],"readwrite");n=n.objectStore("games"),postMessage({message:"Updating Database..."});for(var o in s){var g=n.put(s[o],s[o].ZUID);t[s[o].ZPLATFORM]="",g.addEventListener("success",function(e){}),g.addEventListener("error",function(e){postMessage({message:"There was an Error Updating the Database: "+e.target.error.name})})}postMessage({message:"Database Updated."});var i=[];for(var d in t)i.push(d);i.sort(),postMessage({localStore:{platforms:i}}),postMessage("done"),a.close()}}},a.addEventListener.onerror=function(e){postMessage({message:"There was an Error Loading the Database"})},a.addEventListener.onblocked=function(e){postMessage({message:"Database Access Blocked. This is why we can't have nice things."})}}catch(t){postMessage({message:"There was an error getting the games from the database."}),console.log(t)}}),request.open("post","../gamepedia.importer.php"),request.send();
//# sourceMappingURL=./gamepedia.importer.min.map